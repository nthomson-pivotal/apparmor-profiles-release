# AppArmor Profile BOSH Release

This BOSH release is designed to act as an addon to apply AppArmor profiles to Xenial-based BOSH VMs.
It is left up to the user to create appropriate AppArmor profiles to satify their restrictions.

## Adding Profiles

Currently you must add profiles directly to the repository and rebuild the release to deploy. The overall
steps are:

- Use `pf -ef` or some other mechanism to obtain the name of the process that is to be profiled
- Generate your profile using the likes of `aa-genprof`
- Create a file in `jobs/apparmor-profiles/templates` that matches the name generated by `aa-genprof`
- Add an entry to the `profiles` property in `jobs/apparmor-profiles/spec` that matches the name of your templates
- Create and deploy a release

## Using aa-genprof with BOSH Jobs

Using `aa-genprod` with BOSH jobs may not generate the expected results without some intervention. For example:

```
aa-genprof /var/vcap/packages/gorouter/bin/gorouter
```

Will result in a profile being generated with a name similar to:

```
var.vcap.data.packages.gorouter.1442407bc8bc09287cce336e6d9d44e75c285cef.bin.gorouter
```

This name will obviously not be portable between versions of `gorouter`, as the sha of the package will change. To 
fix this, simply rename the generated profile to the name that was originally obtained from `ps -ef`, which would
result in:

```
/etc/apparmor.d/var.vcap.packages.gorouter.bin.gorouter
```